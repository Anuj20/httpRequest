___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "__wm": "VGVtcGxhdGUtQXV0aG9yX1NlcnZlckNvbnRhaW5lck1vbml0b3ItU2ltby1BaGF2YQ\u003d\u003d",
  "categories": [
    "UTILITY"
  ],
  "version": 1,
  "securityGroups": [],
  "displayName": "HTTP Request  - Simple",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "This sGTM template streamlines HTTP request creation by automating JSON generation, reducing syntax errors. Define key-value pairs for headers and body; the template handles backend code compilation.",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "LABEL",
    "name": "POST request",
    "displayName": "POST request only"
  },
  {
    "type": "TEXT",
    "name": "endpoint",
    "displayName": "Endpoint",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "help": "Set the Destination URL here"
  },
  {
    "type": "GROUP",
    "name": "requestHeaders",
    "displayName": "Request Headers",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "SIMPLE_TABLE",
        "name": "reqHeaders",
        "displayName": "Add the Request Headers",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Key",
            "name": "key",
            "type": "TEXT"
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ]
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "requestBody",
    "displayName": "Request Body",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "SIMPLE_TABLE",
        "name": "reqBody",
        "displayName": "Add the request body",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Key",
            "name": "key",
            "type": "TEXT"
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ]
      }
    ]
  }
]


___SANDBOXED_JS_FOR_SERVER___

const getAllEventData = require('getAllEventData');
const JSON = require('JSON');
const sendHttpRequest = require('sendHttpRequest');
const logToConsole = require('logToConsole');
const getRequestHeader = require('getRequestHeader');
//var parseISO = require('date-fns');
const gettimestamp = require('getTimestampMillis');

//const traceId = getRequestHeader('trace-id');



const postHeaders = {'Content-Type': 'application/json'};

let postBodyData = {};

if (data.reqHeaders) {
    for (let key in data.reqHeaders) {
        postHeaders[data.reqHeaders[key].key] = data.reqHeaders[key].value;
    }
}

if (data.reqBody) {
    for (let key in data.reqBody) {
      
        postBodyData[data.reqBody[key].key] = data.reqBody[key].value;
      
    }
}

//let num2="12345";
const postBody = JSON.stringify(postBodyData);
let requestOptions = {headers: postHeaders, method: 'POST'};

logToConsole(JSON.stringify({
        'Name': 'JsonRequest',
        'Type': 'Request',
        //'TraceId': traceId,
        'RequestMethod': 'POST',
        'RequestUrl': data.endpoint,
        'RequestBody': postBodyData,
    }));

sendHttpRequest(data.endpoint, (statusCode, headers, body) => {
  //  if (isLoggingEnabled) {
        logToConsole(JSON.stringify({
            'Name': 'JsonRequest',
            'Type': 'Response',
           // 'TraceId': traceId,
            'ResponseStatusCode': statusCode,
            'ResponseHeaders': headers,
            'ResponseBody': body,
        }));
   // }

    if (statusCode >= 200 && statusCode < 300) {
        data.gtmOnSuccess();
      logToConsole("success");
    } else {
        data.gtmOnFailure();
      logToConsole("Failure");
    }
}, requestOptions, postBody);

function convertUnixTimestamp(unixTimestamp) {
    // Constants
    const SECONDS_IN_A_MINUTE = 60;
    const SECONDS_IN_AN_HOUR = 3600;
    const SECONDS_IN_A_DAY = 86400;

    // Helper function to check for leap years
    function isLeapYear(year) {
        return (year % 4 == 0 && year % 100 !== 0) || (year % 400 === 0);
    }

    // Helper function to get the number of days in a month
    function daysInMonth(year, month) {
        return [31, (isLeapYear(year) ? 29 : 28), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31][month];
    }

    // Helper function to perform integer division
    function div(a, b) {
        return (a - (a % b)) / b;
    }

    // Calculate seconds, minutes, hours
    const seconds = unixTimestamp % SECONDS_IN_A_MINUTE;
    const minutes = div(unixTimestamp, SECONDS_IN_A_MINUTE) % SECONDS_IN_A_MINUTE;
    const hours = div(unixTimestamp, SECONDS_IN_AN_HOUR) % 24;

    // Calculate days since Unix epoch (1970-01-01)
    let daysSinceEpoch = div(unixTimestamp, SECONDS_IN_A_DAY);
    let year = 1970;
    let month = 0;

    // Calculate the current year
     // for (;;) {
    //const daysInYear = 366;
    //if (daysSinceEpoch < daysInYear) break;
    //daysSinceEpoch -= daysInYear;
    //year++;
//}

    // Calculate the current month
   // while (daysSinceEpoch >= daysInMonth(year, month)) {
   //     daysSinceEpoch -= daysInMonth(year, month);
   //     month += 1;
   // }

    // The day of the month
    const day = daysSinceEpoch + 1;

    // Pad single-digit numbers with leading zeroes
    const pad = (num) => {
        if (num < 10) {
            return '0' + num;
        }
        return num.toString();
    };

    // Format the human-readable date string
   // const humanReadable = `${year}-${pad(month + 1)}-${pad(day)} ${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;

    //return humanReadable;
}

// Example usage
//const unixTimestamp = 1625239261;
//console.log(convertUnixTimestamp(unixTimestamp)); // Output: 2021-07-02 15:34:21


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_event_data",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keyPatterns",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "event_name"
              }
            ]
          }
        },
        {
          "key": "eventDataAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_request",
        "versionId": "1"
      },
      "param": [
        {
          "key": "requestAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "headerAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queryParameterAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 8/12/2020, 2:55:00 PM


